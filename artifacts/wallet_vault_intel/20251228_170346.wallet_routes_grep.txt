== (3) wallet ë¼ìš°í„°/ê²½ë¡œ ë¬¸ìì—´ ì¦ê±° ==
packages/afo-core/services/database_migrations.py:42:-- ì‚¬ìš©ì ì„¸ì…˜ í…Œì´ë¸” (Wallet ì—°ë™)
packages/afo-core/services/database_migrations.py:55:-- API í‚¤ ì‚¬ìš©ëŸ‰ ì¶”ì  (Wallet ì—°ë™)
packages/afo-core/CLAUDE.md:117:- `packages/afo-core/AFO/api_wallet.py` í•µì‹¬ ë¡œì§ ë³€ê²½ ê¸ˆì§€
packages/afo-core/afo_skills_registry.py:943:        description="Manages blockchain interactions, wallet monitoring, and smart contract execution for the Kingdom's assets.",
packages/afo-core/afo_skills_registry.py:945:        tags=["web3", "blockchain", "crypto", "wallet", "smart-contract"],
packages/afo-core/wallet_server.py:3:AFO Wallet Service - API Walletì„ ìœ„í•œ ë…ë¦½ ì„œë¹„ìŠ¤
packages/afo-core/wallet_server.py:4:Phase 20: API Wallet & Vault í¡ìˆ˜
packages/afo-core/wallet_server.py:11:from AFO.api.routes.wallet import wallet_router
packages/afo-core/wallet_server.py:14:    title="AFO Wallet Service",
packages/afo-core/wallet_server.py:15:    description="API Wallet ì„œë¹„ìŠ¤ - í‚¤ ê´€ë¦¬ ë° ë³´ì•ˆ",
packages/afo-core/wallet_server.py:31:    return {"status": "healthy", "service": "wallet-service"}
packages/afo-core/wallet_server.py:33:# Wallet routes
packages/afo-core/wallet_server.py:34:app.include_router(wallet_router)
packages/afo-core/wallet_server.py:38:        "wallet_server:app",
packages/afo-core/get_browser_token.js:38:console.log("\nğŸ’¡ ìœ„ì˜ í† í° ì¤‘ í•˜ë‚˜ë¥¼ ë³µì‚¬í•˜ì—¬ API Walletì— ì €ì¥í•˜ì„¸ìš”.");
packages/afo-core/kms/vault_kms.py:13:    HashiCorp Vault KMS implementation for API Wallet.
packages/afo-core/kms/vault_kms.py:20:        self.secret_path = os.getenv("VAULT_SECRET_PATH", "api_wallet/keys")
packages/afo-core/services/security/rate_limit_policy.py:44:                    "/auth,/billing,/wallet,/admin",
packages/afo-core/config/settings_dev.py:35:    API_WALLET_URL: str = "http://localhost:8000"
packages/afo-core/config/settings_test.py:36:    API_WALLET_URL: str = "http://localhost:8001"  # í…ŒìŠ¤íŠ¸ìš© í¬íŠ¸
packages/afo-core/input_server.py:9:ì—­í• : API í‚¤ ë° ì„¤ì • ì…ë ¥ì„ ë°›ì•„ API Walletì— ì €ì¥
packages/afo-core/input_server.py:12:2. API Walletìœ¼ë¡œ ì „ì†¡
packages/afo-core/input_server.py:50:# API Wallet ì„œë²„ URL (ì¤‘ì•™ ì„¤ì • ì‚¬ìš© - Phase 1 ë¦¬íŒ©í† ë§)
packages/afo-core/input_server.py:55:    API_WALLET_URL = settings.API_WALLET_URL
packages/afo-core/input_server.py:57:    API_WALLET_URL = os.getenv("API_WALLET_URL", "http://localhost:8000")
packages/afo-core/input_server.py:130:            response = await client.get(f"{API_WALLET_URL}/api/wallet/list")
packages/afo-core/input_server.py:135:        print(f"âš ï¸  API Wallet ì¡°íšŒ ì‹¤íŒ¨: {e}")
packages/afo-core/input_server.py:428:    API í‚¤ ì¶”ê°€ (API Walletìœ¼ë¡œ ì „ì†¡ + PostgreSQL ì €ì¥)
packages/afo-core/input_server.py:437:        # 1. API Walletìœ¼ë¡œ ì „ì†¡ (ì•”í˜¸í™” ì €ì¥)
packages/afo-core/input_server.py:440:                f"{API_WALLET_URL}/api/wallet/add",
packages/afo-core/input_server.py:485:        print(f"âŒ API Wallet ì„œë²„ ì—°ê²° ì‹¤íŒ¨ ({API_WALLET_URL})")
packages/afo-core/input_server.py:487:            url="/?error=API Wallet ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.",
packages/afo-core/input_server.py:503:    # API Wallet ì—°ê²° í™•ì¸
packages/afo-core/input_server.py:504:    api_wallet_connected = False
packages/afo-core/input_server.py:507:            response = await client.get(f"{API_WALLET_URL}/health")
packages/afo-core/input_server.py:508:            api_wallet_connected = response.status_code == 200
packages/afo-core/input_server.py:529:        "api_wallet_url": API_WALLET_URL,
packages/afo-core/input_server.py:530:        "api_wallet_connected": api_wallet_connected,
packages/afo-core/input_server.py:538:    """API Wallet ì„œë²„ ê°€ìš©ì„± í™•ì¸"""
packages/afo-core/input_server.py:548:    name: str, value: str, service: str, wallet: Any, api_server_url: str | None
packages/afo-core/input_server.py:551:    # 1. API Wallet ì§ì ‘ ì €ì¥ ì‹œë„
packages/afo-core/input_server.py:552:    if wallet:
packages/afo-core/input_server.py:554:            if wallet.get(name, decrypt=False):
packages/afo-core/input_server.py:556:            wallet.add(
packages/afo-core/input_server.py:570:    # 2. API Wallet ì„œë²„ ì €ì¥ ì‹œë„ (Fallback)
packages/afo-core/input_server.py:575:                chk = await client.get(f"{api_server_url}/api/wallet/get/{name}", timeout=2.0)
packages/afo-core/input_server.py:581:                    f"{api_server_url}/api/wallet/add",
packages/afo-core/input_server.py:601:    return "API Wallet unavailable"
packages/afo-core/input_server.py:612:        # Wallet ì¸ìŠ¤í„´ìŠ¤ ì¤€ë¹„
packages/afo-core/input_server.py:613:        wallet = None
packages/afo-core/input_server.py:615:            from api_wallet import APIWallet
packages/afo-core/input_server.py:617:            wallet = APIWallet()
packages/afo-core/input_server.py:621:        server_url = API_WALLET_URL if await _is_api_server_available(API_WALLET_URL) else None
packages/afo-core/input_server.py:627:            res = await _import_single_key(name, value, service, wallet, server_url)
packages/afo-core/input_server.py:701:    print(f"API Wallet URL: {API_WALLET_URL}")
packages/afo-core/browser_auth/stealth_login.py:21:    from AFO.api_wallet import APIWallet
packages/afo-core/browser_auth/stealth_login.py:23:    print("âœ… APIWallet module loaded successfully.")
packages/afo-core/browser_auth/stealth_login.py:25:    print(f"âš ï¸ APIWallet import failed: {e}")
packages/afo-core/browser_auth/stealth_login.py:29:        from api_wallet import APIWallet
packages/afo-core/browser_auth/stealth_login.py:31:        print("âœ… APIWallet loaded via fallback.")
packages/afo-core/browser_auth/stealth_login.py:33:        print("âŒ APIWallet NOT found. Tokens will NOT be saved.")
packages/afo-core/browser_auth/stealth_login.py:34:        APIWallet = None
packages/afo-core/browser_auth/stealth_login.py:168:        # Save to Wallet
packages/afo-core/browser_auth/stealth_login.py:169:        if APIWallet:
packages/afo-core/browser_auth/stealth_login.py:170:            wallet = APIWallet()
packages/afo-core/browser_auth/stealth_login.py:172:            wallet.add(
packages/afo-core/browser_auth/stealth_login.py:180:            print(f"ğŸ’¾ Securely saved to Wallet as '{key_name}'", flush=True)
packages/afo-core/config/settings.py:93:    # API Wallet Settings
packages/afo-core/config/settings.py:95:    API_WALLET_URL: str = Field(default="http://localhost:8000", description="API Wallet ì„œë²„ URL")
packages/afo-core/config/settings.py:142:    API_WALLET_ENCRYPTION_KEY: str | None = Field(
packages/afo-core/config/settings.py:143:        default=None, description="API Wallet ì•”í˜¸í™” í‚¤ (Fernet, 44ì)"
packages/afo-core/pyproject.toml:107:"api_wallet.py" = ["F401"]
packages/afo-core/api_wallet.py:4:API Wallet - ëª¨ë“  API í‚¤ë¥¼ ì•ˆì „í•˜ê²Œ ë³´ê´€
packages/afo-core/api_wallet.py:89:class APIWallet:
packages/afo-core/api_wallet.py:91:    API Wallet - ì•”í˜¸í™” í‚¤ ê´€ë¦¬ ì‹œìŠ¤í…œ
packages/afo-core/api_wallet.py:107:        Initialize API Wallet
packages/afo-core/api_wallet.py:158:                    or os.getenv("API_WALLET_ENCRYPTION_KEY", self._generate_default_key())
packages/afo-core/api_wallet.py:168:                or os.getenv("API_WALLET_ENCRYPTION_KEY", self._generate_default_key())
packages/afo-core/api_wallet.py:198:            self.storage_path = base_dir / "api_wallet_storage.json"
packages/afo-core/api_wallet.py:204:        self.audit_log_path = base_dir / "api_wallet_audit.log"
packages/afo-core/api_wallet.py:211:            return get_settings().API_WALLET_ENCRYPTION_KEY
packages/afo-core/api_wallet.py:227:                        if line.strip().startswith("API_WALLET_ENCRYPTION_KEY="):
packages/afo-core/api_wallet.py:267:            raise OSError(f"Failed to persist wallet data: {e}") from e
packages/afo-core/api_wallet.py:295:        Add a new API key to wallet
packages/afo-core/api_wallet.py:419:        List all keys in wallet
packages/afo-core/api_wallet.py:462:        Delete a key from wallet
packages/afo-core/api_wallet.py:553:            # Use the same key format as Monitoring Service: wallet:usage:{provider}
packages/afo-core/api_wallet.py:556:            redis_key = f"wallet:usage:{provider}"
packages/afo-core/api_wallet.py:563:            # Fail silently for Redis sync to avoid breaking the wallet if Redis is down
packages/afo-core/api_wallet.py:564:            print(f"âš ï¸  Failed to sync wallet usage to Redis: {e}")
packages/afo-core/api_wallet.py:586:            redis_key = f"wallet:usage:{provider}"
packages/afo-core/api_wallet.py:593:        """Get wallet summary"""
packages/afo-core/api_wallet.py:626:    def save_wallet(self) -> None:
packages/afo-core/api_wallet.py:627:        """Save wallet (no-op since auto-save is implemented)"""
packages/afo-core/api_wallet.py:818:def create_wallet(encryption_key: str | None = None) -> APIWallet:
packages/afo-core/api_wallet.py:819:    """Create a new API Wallet instance"""
packages/afo-core/api_wallet.py:820:    return APIWallet(encryption_key=encryption_key)
packages/afo-core/api_wallet.py:827:    wallet = create_wallet()
packages/afo-core/api_wallet.py:830:        print("API Wallet CLI")
packages/afo-core/api_wallet.py:832:        print("  python api_wallet.py add <name> <key> [service]")
packages/afo-core/api_wallet.py:833:        print("  python api_wallet.py get <name>")
packages/afo-core/api_wallet.py:834:        print("  python api_wallet.py list")
packages/afo-core/api_wallet.py:835:        print("  python api_wallet.py delete <name>")
packages/afo-core/api_wallet.py:843:                print("Usage: python api_wallet.py add <name> <key> [service]")
packages/afo-core/api_wallet.py:850:            key_id = wallet.add(name, key, service=service)
packages/afo-core/api_wallet.py:855:                print("Usage: python api_wallet.py get <name>")
packages/afo-core/api_wallet.py:859:            key = wallet.get(name) or ""
packages/afo-core/api_wallet.py:866:            keys = wallet.list_keys()
packages/afo-core/api_wallet.py:867:            print(f"ğŸ“‹ Wallet Keys ({len(keys)}):")
packages/afo-core/api_wallet.py:873:                print("Usage: python api_wallet.py delete <name>")
packages/afo-core/api_wallet.py:877:            if wallet.delete(name):
packages/afo-core/tests/conftest_wallet.py:4:Conftest for API Wallet tests.
packages/afo-core/tests/conftest_wallet.py:17:def isolate_api_wallet_module() -> None:
packages/afo-core/tests/conftest_wallet.py:19:    Autouse fixture that cleans up api_wallet module state before and after each test.
packages/afo-core/tests/conftest_wallet.py:24:        "AFO.api_wallet",
packages/afo-core/tests/conftest_wallet.py:25:        "api_wallet",
packages/afo-core/tests/test_utils.py:99:    def test_detect_api_wallet_path(self) -> None:
packages/afo-core/tests/test_utils.py:100:        """API Wallet ê²½ë¡œ ê°ì§€ í…ŒìŠ¤íŠ¸"""
packages/afo-core/tests/test_utils.py:106:            path = detector.detect_api_wallet_path()
packages/afo-core/tests/test_utils.py:110:        assert detector.detect_api_wallet_path() == path
packages/afo-core/tests/test_utils.py:112:    def test_detect_api_wallet_path_env(self) -> None:
packages/afo-core/tests/test_utils.py:123:                    path = detector.detect_api_wallet_path()
packages/afo-core/docs/reports/PH18_PH19_ABSOLUTE_CODE_PERFECTION.md:20:- Wallet Session mapping typing aligned via explicit casting / TypedDict
packages/afo-core/tests/SKIP_TEST_ANALYSIS.md:23:### 1ï¸âƒ£ test_api_wallet_imports.py:13
packages/afo-core/tests/SKIP_TEST_ANALYSIS.md:29:- **ëª©ì **: `.env` íŒŒì¼ì—ì„œ `API_WALLET_ENCRYPTION_KEY` ì½ê¸° ê²€ì¦
packages/afo-core/tests/SKIP_TEST_ANALYSIS.md:32:  - `api_wallet.py:209-232`ì—ì„œ `_generate_default_key()` êµ¬í˜„ë¨
packages/afo-core/tests/SKIP_TEST_ANALYSIS.md:45:### 2ï¸âƒ£ test_api_wallet_imports.py:37
packages/afo-core/tests/SKIP_TEST_ANALYSIS.md:54:  - `api_wallet.py:209-232` í™•ì¸ ê²°ê³¼, **ì½ê¸°ë§Œ êµ¬í˜„ë¨, ì“°ê¸°ëŠ” ì—†ìŒ**
packages/afo-core/tests/SKIP_TEST_ANALYSIS.md:164:  - API Wallet í†µí•©ë¨
packages/afo-core/tests/SKIP_TEST_ANALYSIS.md:176:**í…ŒìŠ¤íŠ¸**: `test_claude_init_wallet_fallback()`  
packages/afo-core/tests/SKIP_TEST_ANALYSIS.md:177:**ìŠ¤í‚µ ì´ìœ **: Module caching makes wallet mock unreliable  
packages/afo-core/tests/SKIP_TEST_ANALYSIS.md:181:- **ëª©ì **: API Wallet fallbackì„ í†µí•œ Claude ì´ˆê¸°í™” ê²€ì¦
packages/afo-core/tests/SKIP_TEST_ANALYSIS.md:184:  - `llms/claude_api.py`: API Wallet í†µí•© êµ¬í˜„ë¨
packages/afo-core/tests/SKIP_TEST_ANALYSIS.md:185:  - `api_wallet.py`: ì™„ì „í•œ Wallet êµ¬í˜„ë¨
packages/afo-core/tests/SKIP_TEST_ANALYSIS.md:186:  - í™˜ê²½ ë³€ìˆ˜ â†’ API Wallet fallback ìˆœì„œ
packages/afo-core/tests/SKIP_TEST_ANALYSIS.md:201:| 1 | test_api_wallet_imports.py:13 | C (Flaky) | **ì‚­ì œ** | ê¸°ëŠ¥ êµ¬í˜„ë¨, flaky ë¶ˆí•„ìš” |
packages/afo-core/tests/SKIP_TEST_ANALYSIS.md:202:| 2 | test_api_wallet_imports.py:37 | C (ë¯¸êµ¬í˜„) | **ì‚­ì œ** | ì˜ë„ì ìœ¼ë¡œ êµ¬í˜„ ì•ˆ í•¨ (ë³´ì•ˆ), Vault KMSê°€ ë” ë‚˜ìŒ |
packages/afo-core/tests/SKIP_TEST_ANALYSIS.md:235:   - `test_api_wallet_imports.py:13` - `.env` ì½ê¸° (flaky)
packages/afo-core/tests/SKIP_TEST_ANALYSIS.md:236:   - `test_api_wallet_imports.py:37` - `.env` ì“°ê¸° (ì˜ë„ì  ë¯¸êµ¬í˜„)
packages/afo-core/tests/SKIP_TEST_ANALYSIS.md:238:   - `test_llm_implementations.py:20` - Claude Wallet fallback (flaky)
packages/afo-core/tests/llm/test_llm_implementations.py:21:# DELETED: test_claude_init_wallet_fallback()
packages/afo-core/tests/llm/test_llm_implementations.py:23:# API Wallet fallbackì€ llms/claude_api.pyì—ì„œ ì´ë¯¸ ê²€ì¦ë¨
packages/afo-core/utils/container_detector.py:101:    def detect_api_wallet_path(self) -> str:
packages/afo-core/utils/container_detector.py:102:        """API Wallet íŒŒì¼ ê²½ë¡œ ìë™ ê°ì§€"""
packages/afo-core/utils/container_detector.py:103:        if "api_wallet_path" in self._cache:
packages/afo-core/utils/container_detector.py:104:            return str(self._cache["api_wallet_path"])
packages/afo-core/utils/container_detector.py:120:                Path(afo_home) / "afo_soul_engine" / "api_wallet_storage.json"
packages/afo-core/utils/container_detector.py:125:                Path(afo_soul_engine_home) / "api_wallet_storage.json"
packages/afo-core/utils/container_detector.py:129:            Path.home() / "AFO" / "afo_soul_engine" / "api_wallet_storage.json",
packages/afo-core/utils/container_detector.py:130:            Path("/Users/brnestrm/AFO/afo_soul_engine/api_wallet_storage.json"),
packages/afo-core/utils/container_detector.py:131:            Path("/home/user/AFO/afo_soul_engine/api_wallet_storage.json"),
packages/afo-core/utils/container_detector.py:132:            Path(__file__).parent.parent / "api_wallet_storage.json",  # ìƒëŒ€ ê²½ë¡œ
packages/afo-core/utils/container_detector.py:137:                self._cache["api_wallet_path"] = str(path)
packages/afo-core/utils/container_detector.py:141:        default = str(Path(__file__).parent.parent / "api_wallet_storage.json")
packages/afo-core/utils/container_detector.py:142:        self._cache["api_wallet_path"] = default
packages/afo-core/utils/container_detector.py:171:def get_api_wallet_path() -> str:
packages/afo-core/utils/container_detector.py:172:    """API Wallet íŒŒì¼ ê²½ë¡œ ë°˜í™˜ (í¸ì˜ í•¨ìˆ˜)"""
packages/afo-core/utils/container_detector.py:173:    return _default_detector.detect_api_wallet_path()
packages/afo-core/tests/test_input_server_advanced.py:9:# We intentionally want api_wallet import to FAIL to test the HTTP fallback
packages/afo-core/tests/test_input_server_advanced.py:20:    # We need to simulate imported module state where 'api_wallet' is NOT available
packages/afo-core/tests/test_input_server_advanced.py:23:    # Easier: patch 'AFO.input_server.APIWallet' to raise ImportError?
packages/afo-core/tests/test_input_server_advanced.py:24:    # The code does `from api_wallet import APIWallet`.
packages/afo-core/tests/test_input_server_advanced.py:29:        sys.modules, {"api_wallet": None}
packages/afo-core/tests/test_input_server_advanced.py:35:        # Let's look at input_server.py again. It does `from api_wallet import APIWallet` inside `bulk_import`.
packages/afo-core/tests/test_input_server_advanced.py:55:    Test bulk_import when direct APIWallet access fails, forcing HTTP API usage.
packages/afo-core/tests/test_input_server_advanced.py:57:    # 1. Mock APIWallet usage to FAIL
packages/afo-core/tests/test_input_server_advanced.py:60:    #     from api_wallet import APIWallet
packages/afo-core/tests/test_input_server_advanced.py:61:    #     wallet = APIWallet()
packages/afo-core/tests/test_input_server_advanced.py:62:    # except Exception: wallet = None
packages/afo-core/tests/test_input_server_advanced.py:64:    # We can mock `api_wallet.APIWallet` to raise an exception upon instantiation
packages/afo-core/tests/test_input_server_advanced.py:65:    # This assumes `api_wallet` module IS importable (mocked or real)
packages/afo-core/tests/test_input_server_advanced.py:67:    mock_wallet_module = MagicMock()
packages/afo-core/tests/test_input_server_advanced.py:68:    mock_wallet_class = MagicMock()
packages/afo-core/tests/test_input_server_advanced.py:69:    mock_wallet_class.side_effect = Exception("Direct Access Denied")  # Force failure
packages/afo-core/tests/test_input_server_advanced.py:70:    mock_wallet_module.APIWallet = mock_wallet_class
packages/afo-core/tests/test_input_server_advanced.py:98:    # Patch sys.modules to provide our 'api_wallet' that fails instantiation
packages/afo-core/tests/test_input_server_advanced.py:99:    with patch.dict(sys.modules, {"api_wallet": mock_wallet_module}):
packages/afo-core/tests/test_api_wallet.py:3:Tests for api_wallet.py
packages/afo-core/tests/test_api_wallet.py:4:API Wallet í…ŒìŠ¤íŠ¸ - Phase 4
packages/afo-core/tests/test_api_wallet.py:10:class TestAPIWalletConfig:
packages/afo-core/tests/test_api_wallet.py:11:    """API Wallet ì„¤ì • í…ŒìŠ¤íŠ¸"""
packages/afo-core/tests/test_api_wallet.py:19:    def test_wallet_storage_path(self) -> None:
packages/afo-core/tests/test_api_wallet.py:20:        """Wallet ì €ì¥ ê²½ë¡œ í…ŒìŠ¤íŠ¸"""
packages/afo-core/tests/test_api_wallet.py:21:        path = "data/api_wallet.json"
packages/afo-core/tests/test_api_wallet.py:31:class TestAPIWalletKeyManagement:
packages/afo-core/tests/test_api_wallet.py:32:    """API Wallet í‚¤ ê´€ë¦¬ í…ŒìŠ¤íŠ¸"""
packages/afo-core/tests/test_api_wallet.py:55:class TestAPIWalletSecurity:
packages/afo-core/tests/test_api_wallet.py:56:    """API Wallet ë³´ì•ˆ í…ŒìŠ¤íŠ¸"""
packages/afo-core/tests/test_api_wallet.py:75:class TestAPIWalletOperations:
packages/afo-core/tests/test_api_wallet.py:76:    """API Wallet ì˜¤í¼ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸"""
packages/afo-core/tests/test_api_wallet.py:80:        wallet = {}
packages/afo-core/tests/test_api_wallet.py:81:        wallet["test_key"] = "value"
packages/afo-core/tests/test_api_wallet.py:82:        assert "test_key" in wallet
packages/afo-core/tests/test_api_wallet.py:86:        wallet = {"test_key": "value"}
packages/afo-core/tests/test_api_wallet.py:87:        del wallet["test_key"]
packages/afo-core/tests/test_api_wallet.py:88:        assert "test_key" not in wallet
packages/afo-core/tests/test_api_wallet.py:92:        wallet = {"key1": "v1", "key2": "v2"}
packages/afo-core/tests/test_api_wallet.py:93:        keys = list(wallet.keys())
packages/afo-core/tests/test_api_wallet.py:103:class TestAPIWalletFallback:
packages/afo-core/tests/test_api_wallet.py:104:    """API Wallet í´ë°± í…ŒìŠ¤íŠ¸"""
