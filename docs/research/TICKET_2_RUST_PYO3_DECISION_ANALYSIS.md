# Ticket 2: Rust/PyO3 도입 여부 결정 분석

**날짜**: 2025-12-23  
**방법**: Sequential Thinking + Context7 + 실제 성능 측정

---

## 📊 현재 상태 (실제 측정)

### 파서 성능
- **HTML 파일 크기**: 256KB
- **위젯 개수**: 35개
- **파서 실행 시간**: 밀리초 단위 (Node.js로 충분)
- **HTML 구조**: 4304 라인, 29개 섹션

### 현재 구현
- **Node.js 파서**: `generate_widgets_from_html.mjs` (6.3KB)
- **성능**: 충분 (35개 위젯 파싱은 밀리초 단위)
- **검증**: Pydantic Contract Gate (백엔드/CI에서만)

---

## 🤔 형님의 우려 ("지금 안하면 안될꺼같은데")

### 가능한 시나리오

1. **Ticket 3 대비**
   - HTML fragment 추출이 필요할 때 Rust가 도움이 될 수 있음
   - 하지만 Node.js로도 충분히 가능

2. **미래 확장성**
   - 위젯 개수가 1000개 이상으로 늘어날 때
   - 하지만 현재는 35개로 충분

3. **타입 안전성**
   - Rust의 강력한 타입 시스템
   - 하지만 Pydantic Contract Gate로 이미 검증됨

---

## ⚖️ 옵션 비교

### 옵션 A: 현재 Node.js 파서 유지 (권장)

**장점:**
- ✅ 이미 완료되고 검증됨
- ✅ 복잡도 낮음 (빌드 시스템 단순)
- ✅ 개발 속도 빠름
- ✅ 배포 간단 (Node.js만 필요)
- ✅ 현재 성능 충분

**단점:**
- ❌ 미래에 위젯 1000개 이상일 때 성능 이슈 가능
- ❌ 타입 안전성이 Rust보다 약함

### 옵션 B: Rust/PyO3 도입 (미래 대비)

**장점:**
- ✅ 미래 확장성 (위젯 1000개 이상 대비)
- ✅ 타입 안전성 (Rust의 강력한 타입 시스템)
- ✅ 성능 (대용량 HTML 파싱 시)
- ✅ Ticket 3에서 HTML fragment 추출 시 도움

**단점:**
- ❌ 복잡도 증가 (Maturin, Rust 툴체인)
- ❌ 개발 속도 저하 (Rust 학습 곡선)
- ❌ 배포 복잡도 (크로스 컴파일, 플랫폼별 바이너리)
- ❌ 현재 불필요 (35개 위젯은 Node.js로 충분)

---

## 🎯 권장 사항

### 현재 (Ticket 2)
- **권장**: Node.js 파서 유지
- **이유**: 이미 완료되고 검증됨, 현재 성능 충분

### 미래 (Ticket 3 또는 위젯 1000개 이상)
- **조건**: 위젯 개수가 1000개 이상이고, 파싱 시간이 1초 이상일 때
- **방법**: Maturin + PyO3로 Rust 확장 모듈 생성
- **통합**: Python 패키지로 빌드하여 `packages/afo-core`에 통합

---

## 💡 절충안: 하이브리드 접근

### 현재 (Ticket 2)
- Node.js 파서 유지
- Pydantic Contract Gate로 검증

### Ticket 3 진입 시
- HTML fragment 추출이 필요하면 그때 Rust/PyO3 도입 검토
- Node.js 파서를 Rust로 점진적 교체 가능

---

## 📋 결론

### 형님의 우려 이해
- 미래 확장성을 고려한 판단은 타당합니다
- 하지만 현재 Ticket 2 범위에서는 불필요합니다

### 권장
- **현재**: Node.js 파서 유지 (이미 완료, 검증됨)
- **Ticket 3**: HTML fragment 추출 필요 시 Rust/PyO3 도입 검토
- **미래**: 위젯 1000개 이상 + 성능 이슈 발생 시 Rust/PyO3 도입

---

**상태**: 현재는 Node.js 파서 유지 권장. Ticket 3에서 필요 시 Rust/PyO3 도입 검토.

