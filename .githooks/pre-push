#!/usr/bin/env bash
set -euo pipefail

allow="${ALLOW_PUSH_MAIN:-0}"
while read -r local_ref local_sha remote_ref remote_sha; do
  if [[ "$remote_ref" == "refs/heads/main" && "$allow" != "1" ]]; then
    echo "BLOCK: direct push to main is disabled."
    echo "Use PR/merge. Emergency only: ALLOW_PUSH_MAIN=1"
    exit 1
  fi
done

python scripts/ssot_truthgate.py gate
exit 0
